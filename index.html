<!DOCTYPE html>
<html lang="en">
  <head>
    <title>gfx fundamentals</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
    html {
      box-sizing: border-box;
    }
    *, *:before, *:after {
      box-sizing: inherit;
    }
    body {
      margin: 0;
      font-family: sans-serif;
      font-size: xx-large;
      color: white;
      background: #000;
    }
    canvas {
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
    }
    .front {
      position: absolute;
      left: 0;
      top: 0;
      width: 100vw;
    }
    .front>* {
      max-width: 900px;
      margin: 0 auto;
    }
    .banner {
      text-align: center;
      gbackground: #000;
      color: #ff2a2a;
      padding: 1em;
    }
    .banner>div {
      padding-top: 1em;
      padding-bottom: 1em;
      background: blue;
      background: linear-gradient(-40deg, rgba(0,204,255,1) 0%, rgba(201,215,251,1) 31%, rgba(0,211,255,1) 100%);
    }
    .banner img {
      display: block;
    }

    :root {
      --outline-color: #00dcff;
    }
    .projects>div {
      text-align: center;
      margin-left: 1em;
      margin-right: 1em;
      margin-top: 1em;
    }
    .projects>div:not(:first-child) {
      margin-top: 1em;
    }
    .projects img {
      width: 100%;
      display: inline-block;
      background-size: 500px;
      background-repeat: no-repeat;
      background-position: center center;
      box-shadow:	0px 0px 8px 2px #000;
    }

    .banner>h1 {
      font-size: 10vw;
      margin: 0;
      color: black;
      text-shadow: 
            0.0px  10.0px 0.02px var(--outline-color),
            9.8px   2.1px 0.02px var(--outline-color),
            4.2px  -9.1px 0.02px var(--outline-color),
           -8.0px  -6.0px 0.02px var(--outline-color),
           -7.6px   6.5px 0.02px var(--outline-color),
            4.8px   8.8px 0.02px var(--outline-color),
            9.6px  -2.8px 0.02px var(--outline-color),
           -0.7px -10.0px 0.02px var(--outline-color),
           -9.9px  -1.5px 0.02px var(--outline-color),
           -3.5px   9.4px 0.02px var(--outline-color),
            8.4px   5.4px 0.02px var(--outline-color),
            7.1px  -7.0px 0.02px var(--outline-color),
           -5.4px  -8.4px 0.02px var(--outline-color),
           -9.4px   3.5px 0.02px var(--outline-color),
            1.4px   9.9px 0.02px var(--outline-color),
           10.0px   0.8px 0.02px var(--outline-color),
            2.9px  -9.6px 0.02px var(--outline-color),
           -8.7px  -4.8px 0.02px var(--outline-color),
           -6.6px   7.5px 0.02px var(--outline-color),
            5.9px   8.0px 0.02px var(--outline-color),
            9.1px  -4.1px 0.02px var(--outline-color),
           -2.1px  -9.8px 0.02px var(--outline-color),
          -10.0px  -0.1px 0.02px var(--outline-color),
           -2.2px   9.8px 0.02px var(--outline-color),
            9.1px   4.2px 0.02px var(--outline-color),
            6.1px  -8.0px 0.02px var(--outline-color),
           -6.5px  -7.6px 0.02px var(--outline-color),
           -8.8px   4.7px 0.02px var(--outline-color),
            2.7px   9.6px 0.02px var(--outline-color),
           10.0px  -0.6px 0.02px var(--outline-color),
            1.5px  -9.9px 0.02px var(--outline-color),
           -9.3px  -3.6px 0.02px var(--outline-color),
           -5.5px   8.4px 0.02px var(--outline-color),
            7.0px   7.2px 0.02px var(--outline-color),
            8.5px  -5.3px 0.02px var(--outline-color),
           -3.4px  -9.4px 0.02px var(--outline-color),
           -9.9px   1.3px 0.02px var(--outline-color),
           -0.8px  10.0px 0.02px var(--outline-color),
            9.6px   2.9px 0.02px var(--outline-color),
            4.9px  -8.7px 0.02px var(--outline-color),
           -7.5px  -6.7px 0.02px var(--outline-color),
           -8.1px   5.9px 0.02px var(--outline-color),
            4.0px   9.2px 0.02px var(--outline-color),
            9.8px  -2.0px 0.02px var(--outline-color),
            0.2px -10.0px 0.02px var(--outline-color),
           -9.7px  -2.3px 0.02px var(--outline-color),
           -4.3px   9.0px 0.02px var(--outline-color),
            7.9px   6.1px 0.02px var(--outline-color);
    }

    @media (max-width: 600px) {
      body {
        font-size: x-large;
      }
    }
    @media (max-width: 450px) {
      body {
        font-size: large;
      }
    }
    </style>
  </head>
  <body>
<canvas></canvas>
<div class="front">
  <div class="projects">
    <div><a href="https://threejsfundamentals.org"><img src="https://threejsfundamentals.org/threejs/lessons/resources/threejsfundamentals.jpg"></a></div>
    <div><a href="https://webglfundamentals.org"  ><img src="https://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg">      </a></div>
    <div><a href="https://webgl2fundamentals.org" ><img src="https://webgl2fundamentals.org/webgl/lessons/resources/webgl2fundamentals.jpg">    </a></div>
  </div>
</div>

  </body>
  <script src="js/twgl-full.min.js"></script>
  <script>
'use strict';

/* global twgl */

(function() {
  const m4 = twgl.m4;
  const gl = document.querySelector('canvas').getContext('webgl');

  const vs = `
#define PI radians(180.)

vec3 hsv2rgb(vec3 c) {
  c = vec3(c.x, clamp(c.yz, 0.0, 1.0));
  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

mat4 trans(vec3 trans) {
  return mat4(
    1, 0, 0, 0,
    0, 1, 0, 0,
    0, 0, 1, 0,
    trans, 1);
}

mat4 uniformScale(float s) {
  return mat4(
    s, 0, 0, 0,
    0, s, 0, 0,
    0, 0, s, 0,
    0, 0, 0, 1);
}

mat4 persp(float fov, float aspect, float zNear, float zFar) {
  float f = tan(PI * 0.5 - 0.5 * fov);
  float rangeInv = 1.0 / (zNear - zFar);

  return mat4(
    f / aspect, 0, 0, 0,
    0, f, 0, 0,
    0, 0, (zNear + zFar) * rangeInv, -1,
    0, 0, zNear * zFar * rangeInv * 2., 0);
}

mat4 transpose(mat4 m) {
  return mat4(
    m[0][0], m[1][0], m[2][0], m[3][0], 
    m[0][1], m[1][1], m[2][1], m[3][1],
    m[0][2], m[1][2], m[2][2], m[3][2],
    m[0][3], m[1][3], m[2][3], m[3][3]);
}

mat4 lookAt(vec3 eye, vec3 target, vec3 up) {
  vec3 zAxis = normalize(eye - target);
  vec3 xAxis = normalize(cross(up, zAxis));
  vec3 yAxis = cross(zAxis, xAxis);

  return mat4(
    xAxis, 0,
    yAxis, 0,
    zAxis, 0,
    eye, 1);
}

mat4 inverse(mat4 m) {
  float
      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

      b00 = a00 * a11 - a01 * a10,
      b01 = a00 * a12 - a02 * a10,
      b02 = a00 * a13 - a03 * a10,
      b03 = a01 * a12 - a02 * a11,
      b04 = a01 * a13 - a03 * a11,
      b05 = a02 * a13 - a03 * a12,
      b06 = a20 * a31 - a21 * a30,
      b07 = a20 * a32 - a22 * a30,
      b08 = a20 * a33 - a23 * a30,
      b09 = a21 * a32 - a22 * a31,
      b10 = a21 * a33 - a23 * a31,
      b11 = a22 * a33 - a23 * a32,

      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

  return mat4(
      a11 * b11 - a12 * b10 + a13 * b09,
      a02 * b10 - a01 * b11 - a03 * b09,
      a31 * b05 - a32 * b04 + a33 * b03,
      a22 * b04 - a21 * b05 - a23 * b03,
      a12 * b08 - a10 * b11 - a13 * b07,
      a00 * b11 - a02 * b08 + a03 * b07,
      a32 * b02 - a30 * b05 - a33 * b01,
      a20 * b05 - a22 * b02 + a23 * b01,
      a10 * b10 - a11 * b08 + a13 * b06,
      a01 * b08 - a00 * b10 - a03 * b06,
      a30 * b04 - a31 * b02 + a33 * b00,
      a21 * b02 - a20 * b04 - a23 * b00,
      a11 * b07 - a10 * b09 - a12 * b06,
      a00 * b09 - a01 * b07 + a02 * b06,
      a31 * b01 - a30 * b03 - a32 * b00,
      a20 * b03 - a21 * b01 + a22 * b00) / det;
}

mat4 cameraLookAt(vec3 eye, vec3 target, vec3 up) {
  return inverse(lookAt(eye, target, up));
}

// times 2 minus 1
float t2m1(float v) {
  return v * 2. - 1.;
}

// times .5 plus .5
float t5p5(float v) {
  return v * 0.5 + 0.5;
}

float inv(float v) {
  return 1. - v;
}

attribute float vertexId;

uniform vec2 resolution;
uniform float time;
uniform float vertexCount;

varying vec4 v_color;

void main() {
  float deep = floor(pow(vertexCount, 0.33333));
  float down = floor(deep);
  float across = floor(vertexCount / down / deep);
  
  float cx = mod(vertexId, across);
  float cy = mod(floor(vertexId / across), down);
  float cz = floor(vertexId / across / down);
  float cu = cx / (across - 1.);
  float cv = cy / (down - 1.);
  float cw = cz / (deep - 1.);
  
  float ca = cu * 2. - 1.;
  float cd = cv * 2. - 1.;
  float ce = cw * 2. - 1.;
  
  float tm = time * .005;
  mat4 mat = persp(radians(60.0), resolution.x / resolution.y, .1, 1000.0);
  float rad = 2.;
  vec3 eye = vec3(cos(tm) * rad, sin(tm * 0.9) * rad * 1.1, sin(tm) * rad);
  vec3 target = vec3(0);
  vec3 up = vec3(0,1,0);
  
  mat *= cameraLookAt(eye, target, up);
  mat *= trans(vec3(ca, ce, cd) * 2.);
  
  vec3 pos = vec3(0);
    
  gl_Position = mat * vec4(pos, 1);
  
  float sz = 1. - abs((gl_Position.z / gl_Position.w * .5 + .5));
  float st = time;
  float minRez = min(resolution.x, resolution.y);
  gl_PointSize = mix(minRez / 8000., pow(sz, 1.) * 12. * minRez / 1000., sin(st * .2) * .5 + .5);
  gl_PointSize = max(gl_PointSize, 1.0);
 
  float z = gl_Position.w / gl_Position.z * .5 + .5;
  float hue = .5;
  float sat = 1.;
  float val = .7;
  
  v_color = vec4(hsv2rgb(vec3(hue, sat, val)), 1);
}
 
  `;

  const fs = `
  precision mediump float;
  varying vec4 v_color;
  void main() {
    gl_FragColor = v_color;
  }
  `;

  const programInfo = twgl.createProgramInfo(gl, [vs, fs]);
  const ids = new Float32Array(100000);
  for (let i = 0; i < ids.length; ++i) {
    ids[i] = i;
  }

  const arrays = {
    vertexId: {
      numComponents: 1,
      data: ids,
    },
  };
  const bufferInfo = twgl.createBufferInfoFromArrays(gl, arrays);
 
  const uniforms = {
    time: 0,
    resolution: [],
    vertexCount: ids.length,
  };


  function render(time) {
    uniforms.time = time * 0.001;
    twgl.resizeCanvasToDisplaySize(gl.canvas);

    uniforms.resolution[0] = gl.canvas.width;
    uniforms.resolution[1] = gl.canvas.height;

    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
    gl.enable(gl.CULL_FACE);
    gl.enable(gl.DEPTH_TEST);

    gl.useProgram(programInfo.program);
    twgl.setBuffersAndAttributes(gl, programInfo, bufferInfo);
    twgl.setUniforms(programInfo, uniforms);
    twgl.drawBufferInfo(gl, bufferInfo, gl.POINTS);

    requestAnimationFrame(render);
  }
  render();

}());
  </script>
</html>
